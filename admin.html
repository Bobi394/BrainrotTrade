<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ‘‘ Brainrot Admin Center</title>
<style>
  body {
    font-family: Arial;
    background: #101020;
    color: #f5f5f5;
    text-align: center;
  }
  input, button, textarea {
    padding: 8px;
    margin: 5px;
    border-radius: 5px;
    border: none;
  }
  button {
    cursor: pointer;
    background: #4e5efc;
    color: white;
  }
  button:hover { background: #6f7bff; }
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 15px;
    justify-items: center;
    padding: 15px;
    max-width: 1000px;
    margin: auto;
  }
  .brainrot {
    background: #2c2c44;
    padding: 10px;
    border-radius: 10px;
    width: 90%;
    text-align: left;
  }
  img {
    border-radius: 8px;
    display: block;
    margin: 0 auto;
  }
  h1 { margin-top: 20px; }
  #offers {
    margin-top: 30px;
    background: #2c2c44;
    padding: 15px;
    border-radius: 10px;
    max-width: 800px;
    margin-inline: auto;
    text-align: left;
  }
</style>
</head>
<body>

<h1>ğŸ‘‘ Brainrot Admin Panel ğŸ‘‘</h1>

<div id="user-info"></div>

<div id="auth-box">
  <input type="email" id="email" placeholder="E-Mail">
  <input type="password" id="password" placeholder="Passwort">
  <button id="login-btn">Login</button>
  <button id="logout-btn" style="display:none;">Logout</button>
</div>

<h2>ğŸ§  Alle Brainrots</h2>
<button id="create-admin-brainrot" style="display:none;">â• Admin-Brainrot erstellen</button>
<div id="brainrot-list" class="grid">Bitte einloggen...</div>

<h2>ğŸ“œ Alle Angebote</h2>
<div id="offers">Bitte einloggen...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { 
  getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { 
  getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCSGYr4opBpK_G-U7Vs7o5boniVVojClaU",
  authDomain: "brainrottrade-bada5.firebaseapp.com",
  projectId: "brainrottrade-bada5",
  storageBucket: "brainrottrade-bada5.firebasestorage.app",
  messagingSenderId: "141473188329",
  appId: "1:141473188329:web:3548a50d851d8807bbe378",
  measurementId: "G-TJR1CS3SSP"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("login-btn");
const logoutBtn = document.getElementById("logout-btn");
const userInfo = document.getElementById("user-info");
const brainrotList = document.getElementById("brainrot-list");
const offersDiv = document.getElementById("offers");
const createBtn = document.getElementById("create-admin-brainrot");

const ADMIN_EMAIL = "bobstarschwarz@gmx.de";

// ğŸ” Login
loginBtn.onclick = async () => {
  try {
    await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
  } catch(err){ alert("âŒ " + err.message); }
};

// ğŸ” Logout
logoutBtn.onclick = async () => { await signOut(auth); };

// ğŸ‘¤ Auth Status
onAuthStateChanged(auth, (user) => {
  if(user){
    userInfo.textContent = `ğŸ‘¤ Eingeloggt als: ${user.email}`;
    emailInput.style.display = passwordInput.style.display = loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";

    if(user.email === ADMIN_EMAIL){
      createBtn.style.display = "inline-block";
      ladeBrainrots();
      ladeAlleAngebote();
    } else {
      alert("âš ï¸ Kein Zugriff: Nur Admin erlaubt!");
      userInfo.textContent = "âŒ Kein Admin!";
    }
  } else {
    userInfo.textContent = "Nicht eingeloggt";
    emailInput.style.display = passwordInput.style.display = loginBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
    createBtn.style.display = "none";
    brainrotList.innerHTML = "Bitte einloggen...";
    offersDiv.innerHTML = "Bitte einloggen...";
  }
});

// ğŸ§  Alle Brainrots laden
async function ladeBrainrots(){
  const snapshot = await getDocs(collection(db,"brainrots"));
  brainrotList.innerHTML = "";
  snapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const div = document.createElement("div");
    div.className = "brainrot";
    div.innerHTML = `
      <strong>${data.name}</strong><br>
      <em>${data.rarity}</em><br>
      <img src="${data.imageUrl}" width="120"><br>
      <small>ğŸ‘¤ ${data.createdBy || "Unbekannt"}</small><br>
      <button onclick="editBrainrot('${docSnap.id}', ${JSON.stringify(data)})">âœï¸ Bearbeiten</button>
      <button onclick="deleteBrainrot('${docSnap.id}')">ğŸ—‘ï¸ LÃ¶schen</button>
    `;
    brainrotList.appendChild(div);
  });
}

// â• Admin-Brainrot erstellen
createBtn.onclick = async () => {
  const name = prompt("Name des Brainrots:");
  if(!name) return;
  const rarity = prompt("Seltenheit:", "Legendary");
  const imageUrl = prompt("Bild-URL:", "https://placehold.co/120x120");
  const stock = parseInt(prompt("Stock:", 1));

  await addDoc(collection(db,"brainrots"),{
    name,rarity,imageUrl,stock,
    createdBy: "admin",
    createdAt: serverTimestamp()
  });
  alert("âœ… Admin-Brainrot erstellt!");
  ladeBrainrots();
};

// âœï¸ Bearbeiten
window.editBrainrot = async (id, data) => {
  const name = prompt("Neuer Name:", data.name);
  if(!name) return;
  const rarity = prompt("Seltenheit:", data.rarity);
  const imageUrl = prompt("Bild-URL:", data.imageUrl);
  const stock = parseInt(prompt("Stock:", data.stock));
  await updateDoc(doc(db,"brainrots",id), { name,rarity,imageUrl,stock });
  alert("âœ… Aktualisiert!");
  ladeBrainrots();
};

// ğŸ—‘ï¸ LÃ¶schen
window.deleteBrainrot = async (id)=>{
  if(confirm("Willst du diesen Brainrot lÃ¶schen?")){
    await deleteDoc(doc(db,"brainrots",id));
    alert("ğŸ—‘ï¸ GelÃ¶scht!");
    ladeBrainrots();
  }
};

// ğŸ“œ Alle Angebote anzeigen
async function ladeAlleAngebote(){
  const snapshot = await getDocs(collection(db,"offers"));
  offersDiv.innerHTML = "";
  if(snapshot.empty){ offersDiv.innerHTML="Keine Angebote vorhanden."; return; }

  snapshot.forEach(docSnap=>{
    const o = docSnap.data();
    const div = document.createElement("div");
    div.innerHTML = `
      <strong>${o.brainrotName}</strong><br>
      Von: ${o.fromEmail}<br>
      An: ${o.toEmail}<br>
      Roblox: ${o.robloxUsername}<br>
      Angebot: ${o.offerText}<br>
      Status: <b>${o.status}</b><br>
      <button onclick="updateStatus('${docSnap.id}','accepted')">âœ… Annehmen</button>
      <button onclick="updateStatus('${docSnap.id}','rejected')">âŒ Ablehnen</button>
      <button onclick="updateStatus('${docSnap.id}','done')">ğŸ‰ Erledigt</button>
      <hr>
    `;
    offersDiv.appendChild(div);
  });
}

// ğŸ” Status aktualisieren
window.updateStatus = async (id,newStatus)=>{
  await updateDoc(doc(db,"offers",id),{status:newStatus});
  alert("Status geÃ¤ndert!");
  ladeAlleAngebote();
};
</script>

</body>
</html>