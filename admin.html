<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Brainrot üõ†Ô∏è</title>
<style>
  body { font-family: Arial; background:#1e1e2f; color:#f5f5f5; text-align:center; }
  input, button { padding:8px; margin:5px; border-radius:5px; }
  button { cursor:pointer; background:#4e5efc; color:white; border:none; }
  button:hover { background:#6f7bff; }
  .brainrot, .offer { background:#2c2c44; margin:10px auto; padding:10px; width:350px; border-radius:8px; text-align:left; }
  h2 { margin-top:30px; }
</style>
</head>
<body>

<h1>üõ†Ô∏è Brainrot Admin</h1>

<div id="user-info"></div>

<div id="auth-box">
  <input type="email" id="email" placeholder="E-Mail">
  <input type="password" id="password" placeholder="Passwort">
  <button id="login-btn">Login</button>
  <button id="logout-btn" style="display:none;">Logout</button>
</div>

<div id="admin-panel" style="display:none;">
  <h2>Brainrots verwalten</h2>
  <input id="name" placeholder="Name">
  <input id="image" placeholder="Bild URL">
  <input id="rarity" placeholder="Rarity">
  <button id="add-btn">‚ûï Brainrot hinzuf√ºgen</button>
  <div id="brainrot-list">Lade Brainrots...</div>

  <h2>Angebote verwalten</h2>
  <div id="offers-list">Lade Angebote...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

// Firebase config
const firebaseConfig={
  apiKey:"AIzaSyCSGYr4opBpK_G-U7Vs7o5boniVVojClaU",
  authDomain:"brainrottrade-bada5.firebaseapp.com",
  projectId:"brainrottrade-bada5",
  storageBucket:"brainrottrade-bada5.firebasestorage.app",
  messagingSenderId:"141473188329",
  appId:"1:141473188329:web:3548a50d851d8807bbe378",
  measurementId:"G-TJR1CS3SSP"
};

const allowedAdmins = ["bobstarschwarz@gmx.de","bruder@email.de","cousin@email.de"];

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const emailInput=document.getElementById("email");
const passwordInput=document.getElementById("password");
const loginBtn=document.getElementById("login-btn");
const logoutBtn=document.getElementById("logout-btn");
const userInfo=document.getElementById("user-info");
const adminPanel=document.getElementById("admin-panel");

const nameInput=document.getElementById("name");
const imageInput=document.getElementById("image");
const rarityInput=document.getElementById("rarity");
const addBtn=document.getElementById("add-btn");

const brainrotList=document.getElementById("brainrot-list");
const offersList=document.getElementById("offers-list");

// Login / Logout
loginBtn.addEventListener("click", async()=>{
  try{
    await signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value);
    alert("‚úÖ Login erfolgreich!");
  } catch(err){
    alert("‚ùå Fehler: "+err.message);
  }
});

logoutBtn.addEventListener("click", async()=>{
  await signOut(auth);
});

// Auth-Status pr√ºfen
onAuthStateChanged(auth,(user)=>{
  if(user){
    userInfo.textContent=`üë§ Eingeloggt als: ${user.email}`;
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    emailInput.style.display="none";
    passwordInput.style.display="none";

    if(allowedAdmins.includes(user.email)){
      adminPanel.style.display="block";
      ladeBrainrots();
      ladeOffers();
    } else{
      adminPanel.style.display="none";
      alert("‚ùå Kein Adminzugriff");
    }
  } else {
    userInfo.textContent="Nicht eingeloggt";
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    emailInput.style.display="inline-block";
    passwordInput.style.display="inline-block";
    adminPanel.style.display="none";
  }
});

// Brainrots laden
async function ladeBrainrots(){
  brainrotList.innerHTML="Lade...";
  const snapshot = await getDocs(collection(db,"brainrots"));
  brainrotList.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data=docSnap.data();
    const div=document.createElement("div");
    div.className="brainrot";
    div.innerHTML=`
      <strong>${data.name}</strong><br>
      <img src="${data.imageUrl||'https://placehold.co/100x100'}" width="100"><br>
      Rarity: ${data.rarity||'Unbekannt'}<br>
      <button onclick="deleteBrainrot('${docSnap.id}')">üóëÔ∏è L√∂schen</button>
    `;
    brainrotList.appendChild(div);
  });
}

window.deleteBrainrot=async function(id){
  await deleteDoc(doc(db,"brainrots",id));
  ladeBrainrots();
}

// Brainrot hinzuf√ºgen
addBtn.addEventListener("click", async()=>{
  const name=nameInput.value.trim();
  const img=imageInput.value.trim();
  const rarity=rarityInput.value.trim();
  if(!name){ alert("Name fehlt"); return; }
  await addDoc(collection(db,"brainrots"),{ name, imageUrl:img, rarity, createdAt:serverTimestamp() });
  nameInput.value=""; imageInput.value=""; rarityInput.value="";
  ladeBrainrots();
});

// Offers laden (pending only)
async function ladeOffers(){
  offersList.innerHTML="Lade...";
  const snapshot = await getDocs(collection(db,"offers"));
  offersList.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data = docSnap.data();
    if(data.status !== "pending") return;

    const div=document.createElement("div");
    div.className="offer";
    div.innerHTML=`
      <strong>E-Mail:</strong> ${data.fromEmail}<br>
      <strong>Roblox Username:</strong> ${data.robloxUsername}<br>
      <strong>Angebot:</strong> ${data.offerText}<br>
      <strong>Brainrot ID:</strong> ${data.brainrotId}<br>
      <button onclick="acceptOffer('${docSnap.id}')">‚úîÔ∏è Annehmen</button>
      <button onclick="rejectOffer('${docSnap.id}')">‚ùå Ablehnen</button>
    `;
    offersList.appendChild(div);
  });
}

// Angebot annehmen / ablehnen
window.acceptOffer = async function(id){
  await updateDoc(doc(db,"offers",id),{status:"accepted"});
  ladeOffers();
}
window.rejectOffer = async function(id){
  await updateDoc(doc(db,"offers",id),{status:"rejected"});
  ladeOffers();
}
</script>
</body>
</html>