<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Steal a Brainrot - Admin ğŸ› ï¸</title>
<style>
body { font-family: Arial; background:#1b1b2a; color:#f5f5f5; text-align:center; }
input, button { padding:8px; margin:5px; border-radius:5px; border:none; }
button { cursor:pointer; background:#4e5efc; color:white; }
button:hover { background:#6f7bff; }
#admin-section { margin-top:20px; background:#2c2c44; padding:15px; border-radius:10px; max-width:900px; margin:auto; text-align:left; }
#offers, #brainrots-list { margin-top:20px; background:#2c2c44; padding:15px; border-radius:10px; max-width:900px; margin:auto; }
.brainrot-admin, .offer-admin { border-bottom:1px solid #444; padding:5px; margin-bottom:5px; }
input[type=number] { width:60px; }
.status-btn { margin:2px; }
.outofstock { opacity:0.5; }
</style>
</head>
<body>

<h1>ğŸ› ï¸ Steal a Brainrot - Admin Panel ğŸ› ï¸</h1>

<div id="auth-box">
  <input type="email" id="email" placeholder="E-Mail">
  <input type="password" id="password" placeholder="Passwort">
  <button id="login-btn">Login</button>
  <button id="logout-btn" style="display:none;">Logout</button>
</div>

<div id="admin-section" style="display:block;">
  <h2>ğŸ“œ Angebote</h2>
  <div id="offers">Lade...</div>

  <h2>â• Brainrots erstellen</h2>
  <input type="text" id="brainrot-name" placeholder="Name">
  <input type="text" id="brainrot-rarity" placeholder="Rarity">
  <input type="text" id="brainrot-img" placeholder="Bild URL">
  <input type="number" id="brainrot-stock" placeholder="Stock" min="0">
  <button id="add-brainrot">Erstellen</button>

  <h2>ğŸ§  Bestehende Brainrots</h2>
  <div id="brainrots-list">Lade...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = { /* Dein Firebase Config hier */ };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const emailInput=document.getElementById("email");
const passwordInput=document.getElementById("password");
const loginBtn=document.getElementById("login-btn");
const logoutBtn=document.getElementById("logout-btn");
const offersDiv=document.getElementById("offers");
const brainrotsListDiv=document.getElementById("brainrots-list");
const addBrainrotBtn=document.getElementById("add-brainrot");

// Login
loginBtn.addEventListener("click", async()=>{
  try{ await signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value); alert("âœ… Eingeloggt!"); loadAll(); } catch(err){ alert(err.message); }
});
logoutBtn.addEventListener("click", async()=>{ await signOut(auth); location.reload(); });

// ====================
// Brainrots Funktionen
// ====================

// Brainrot erstellen
addBrainrotBtn.addEventListener("click", async()=>{
  const name=document.getElementById("brainrot-name").value.trim();
  const rarity=document.getElementById("brainrot-rarity").value.trim();
  const img=document.getElementById("brainrot-img").value.trim();
  const stock=parseInt(document.getElementById("brainrot-stock").value)||0;
  if(!name){ alert("Name fehlt!"); return; }
  await addDoc(collection(db,"brainrots"),{name,rarity,imageUrl:img,stock});
  loadBrainrots();
});

// Alle Brainrots laden
async function loadBrainrots(){
  brainrotsListDiv.innerHTML="Lade...";
  const snapshot=await getDocs(collection(db,"brainrots"));
  brainrotsListDiv.innerHTML="";
  snapshot.forEach(docSnap=>{
    const b=docSnap.data();
    const div=document.createElement("div");
    div.className="brainrot-admin"+(b.stock===0?" outofstock":"");
    div.innerHTML=`<strong>${b.name}</strong> | Rarity: ${b.rarity} | Stock: <input type="number" value="${b.stock}" id="stock-${docSnap.id}">
    <br>Bild URL: <input type="text" value="${b.imageUrl||''}" id="img-${docSnap.id}">
    <br>
    <button onclick="updateBrainrot('${docSnap.id}')">ğŸ’¾ Speichern</button>
    <button onclick="deleteBrainrot('${docSnap.id}')">ğŸ—‘ï¸ LÃ¶schen</button>`;
    brainrotsListDiv.appendChild(div);
  });
}

window.updateBrainrot=async(id)=>{
  const stock=parseInt(document.getElementById(`stock-${id}`).value)||0;
  const img=document.getElementById(`img-${id}`).value.trim();
  await updateDoc(doc(db,"brainrots",id),{stock,img});
  loadBrainrots();
}
window.deleteBrainrot=async(id)=>{ await deleteDoc(doc(db,"brainrots",id)); loadBrainrots(); }

// ====================
// Offers Funktionen
// ====================

async function loadOffers(){
  offersDiv.innerHTML="Lade...";
  const snapshot=await getDocs(query(collection(db,"offers"),orderBy("createdAt","desc")));
  offersDiv.innerHTML="";
  snapshot.forEach(docSnap=>{
    const o=docSnap.data();
    const div=document.createElement("div");
    div.className="offer-admin";
    div.innerHTML=`<strong>${o.brainrotName}</strong> von ${o.fromEmail}<br>Roblox: ${o.robloxUsername}<br>Angebot: ${o.offerText}<br>Status: ${o.status||"pending"}<br>
    <button class="status-btn" onclick="updateOffer('${docSnap.id}','accepted')">âœ… Akzeptieren</button>
    <button class="status-btn" onclick="updateOffer('${docSnap.id}','rejected')">âŒ Ablehnen</button>
    <button class="status-btn" onclick="updateOffer('${docSnap.id}','done')">ğŸ‰ Fertig</button>
    <button class="status-btn" onclick="deleteOffer('${docSnap.id}')">ğŸ—‘ï¸ LÃ¶schen</button>`;
    offersDiv.appendChild(div);
  });
}

window.updateOffer=async(id,status)=>{ await updateDoc(doc(db,"offers",id),{status}); loadOffers(); }
window.deleteOffer=async(id)=>{ await deleteDoc(doc(db,"offers",id)); loadOffers(); }

// ====================
// Initial Load
// ====================
async function loadAll(){
  loadBrainrots();
  loadOffers();
}
</script>

</body>
</html>