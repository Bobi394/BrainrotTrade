<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brainrot Admin ğŸ§ </title>
<style>
  body {font-family:Arial;background:#1e1e2f;color:#f5f5f5;text-align:center;}
  input,button{padding:8px;margin:5px;border-radius:5px;}
  button{cursor:pointer;background:#4e5efc;color:white;border:none;}
  button:hover{background:#6f7bff;}
  .brainrot,.offer{background:#2c2c44;margin:10px auto;padding:10px;width:360px;border-radius:8px;text-align:left;}
  .outofstock{opacity:0.5;}
  h2{margin-top:30px;}
</style>
</head>
<body>

<h1>ğŸ› ï¸ Brainrot Admin</h1>
<div id="user-info"></div>

<div id="auth-box">
  <input type="email" id="email" placeholder="E-Mail">
  <input type="password" id="password" placeholder="Passwort">
  <button id="login-btn">Login</button>
  <button id="logout-btn" style="display:none;">Logout</button>
</div>

<div id="admin-panel" style="display:none;">
  <h2>Brainrots verwalten</h2>
  <input id="name" placeholder="Name">
  <input id="image" placeholder="Bild URL">
  <input id="rarity" placeholder="Rarity">
  <input id="stock" type="number" min="0" placeholder="Stock">
  <button id="add-btn">â• Brainrot hinzufÃ¼gen</button>
  <div id="brainrot-list">Lade Brainrots...</div>

  <h2>Offene Angebote</h2>
  <div id="offers-pending">Lade...</div>

  <h2>Akzeptierte Angebote</h2>
  <div id="offers-accepted">Lade...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig={
  apiKey:"AIzaSyCSGYr4opBpK_G-U7Vs7o5boniVVojClaU",
  authDomain:"brainrottrade-bada5.firebaseapp.com",
  projectId:"brainrottrade-bada5",
  storageBucket:"brainrottrade-bada5.firebasestorage.app",
  messagingSenderId:"141473188329",
  appId:"1:141473188329:web:3548a50d851d8807bbe378",
  measurementId:"G-TJR1CS3SSP"
};

const allowedAdmins=["bobstarschwarz@gmx.de","maehnen.planen.3y@icloud.com"];

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

const emailInput=document.getElementById("email");
const passwordInput=document.getElementById("password");
const loginBtn=document.getElementById("login-btn");
const logoutBtn=document.getElementById("logout-btn");
const userInfo=document.getElementById("user-info");
const adminPanel=document.getElementById("admin-panel");

const nameInput=document.getElementById("name");
const imageInput=document.getElementById("image");
const rarityInput=document.getElementById("rarity");
const stockInput=document.getElementById("stock");
const addBtn=document.getElementById("add-btn");

const brainrotList=document.getElementById("brainrot-list");
const offersPending=document.getElementById("offers-pending");
const offersAccepted=document.getElementById("offers-accepted");

let brainrotMap={};

loginBtn.addEventListener("click",async()=>{
  try{
    await signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value);
    alert("âœ… Login erfolgreich!");
  }catch(err){alert("âŒ "+err.message);}
});

logoutBtn.addEventListener("click",async()=>{await signOut(auth);});

onAuthStateChanged(auth,(user)=>{
  if(user){
    userInfo.textContent=`ğŸ‘¤ Eingeloggt als: ${user.email}`;
    loginBtn.style.display="none";logoutBtn.style.display="inline-block";
    emailInput.style.display="none";passwordInput.style.display="none";
    if(allowedAdmins.includes(user.email)){adminPanel.style.display="block";ladeBrainrots();ladeOffers();}
    else{adminPanel.style.display="none";alert("âŒ Kein Adminzugriff");}
  }else{
    userInfo.textContent="Nicht eingeloggt";
    loginBtn.style.display="inline-block";logoutBtn.style.display="none";
    emailInput.style.display="inline-block";passwordInput.style.display="inline-block";
    adminPanel.style.display="none";
  }
});

// Brainrots laden
async function ladeBrainrots(){
  brainrotList.innerHTML="Lade...";
  brainrotMap={};
  const snapshot=await getDocs(collection(db,"brainrots"));
  brainrotList.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data=docSnap.data();
    brainrotMap[docSnap.id]=data.name;

    const div=document.createElement("div");
    div.className="brainrot"+(data.stock===0?" outofstock":"");
    div.innerHTML=`
      <strong>Name:</strong> ${data.name}<br>
      <strong>Rarity:</strong> ${data.rarity||'Unbekannt'}<br>
      <strong>Stock:</strong> ${data.stock??0}<br>
      <img src="${data.imageUrl||'https://placehold.co/100x100'}" width="100"><br>
      <button onclick="editBrainrot('${docSnap.id}')">âœï¸ Bearbeiten</button>
      <button onclick="deleteBrainrot('${docSnap.id}')">ğŸ—‘ï¸ LÃ¶schen</button>
      <div id="edit-container-${docSnap.id}" style="display:none; margin-top:5px;">
        <input type="text" id="edit-name-${docSnap.id}" value="${data.name}">
        <input type="text" id="edit-image-${docSnap.id}" value="${data.imageUrl||''}">
        <input type="text" id="edit-rarity-${docSnap.id}" value="${data.rarity||''}">
        <input type="number" id="edit-stock-${docSnap.id}" value="${data.stock??0}" min="0">
        <button onclick="saveBrainrot('${docSnap.id}')">ğŸ’¾ Speichern</button>
        <button onclick="cancelEdit('${docSnap.id}')">âŒ Abbrechen</button>
      </div>`;
    brainrotList.appendChild(div);
  });
}

window.editBrainrot=function(id){document.getElementById(`edit-container-${id}`).style.display="block";}
window.cancelEdit=function(id){document.getElementById(`edit-container-${id}`).style.display="none";}
window.saveBrainrot=async function(id){
  const name=document.getElementById(`edit-name-${id}`).value.trim();
  const img=document.getElementById(`edit-image-${id}`).value.trim();
  const rarity=document.getElementById(`edit-rarity-${id}`).value.trim();
  const stock=parseInt(document.getElementById(`edit-stock-${id}`).value)||0;
  if(!name){alert("Name darf nicht leer sein!");return;}
  await updateDoc(doc(db,"brainrots",id),{name,imageUrl:img,rarity,stock});
  ladeBrainrots();
};
window.deleteBrainrot=async function(id){await deleteDoc(doc(db,"brainrots",id));ladeBrainrots();};

// Brainrot hinzufÃ¼gen
addBtn.addEventListener("click",async()=>{
  const name=nameInput.value.trim();
  const img=imageInput.value.trim();
  const rarity=rarityInput.value.trim();
  const stock=parseInt(stockInput.value)||0;
  if(!name){alert("Name fehlt");return;}
  await addDoc(collection(db,"brainrots"),{name,imageUrl:img,rarity,stock,createdAt:serverTimestamp()});
  nameInput.value="";imageInput.value="";rarityInput.value="";stockInput.value="";
  ladeBrainrots();
});

// Offers laden
async function ladeOffers(){
  offersPending.innerHTML="Lade...";
  offersAccepted.innerHTML="Lade...";
  const snapshot=await getDocs(collection(db,"offers"));
  offersPending.innerHTML="";offersAccepted.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data=docSnap.data();
    if(data.status==="done"||data.status==="rejected")return;
    const div=document.createElement("div");
    div.className="offer";
    div.innerHTML=`
      <strong>E-Mail:</strong> ${data.fromEmail}<br>
      <strong>Roblox Username:</strong> ${data.robloxUsername}<br>
      <strong>Angebot:</strong> ${data.offerText}<br>
      <strong>Brainrot:</strong> ${brainrotMap[data.brainrotId]||data.brainrotId}<br>
      <strong>Status:</strong> ${data.status}<br>`;
    if(data.status==="pending"){
      div.innerHTML+=`<button onclick="acceptOffer('${docSnap.id}')">âœ”ï¸ Annehmen</button>
                      <button onclick="rejectOffer('${docSnap.id}')">âŒ Ablehnen</button>`;
      offersPending.appendChild(div);
    }else if(data.status==="accepted"){
      div.innerHTML+=`<button onclick="markDone('${docSnap.id}')">âœ… Fertig</button>`;
      offersAccepted.appendChild(div);
    }
  });
}
window.acceptOffer=async function(id){await updateDoc(doc(db,"offers",id),{status:"accepted"});ladeOffers();}
window.rejectOffer=async function(id){await updateDoc(doc(db,"offers",id),{status:"rejected"});ladeOffers();}
window.markDone=async function(id){await updateDoc(doc(db,"offers",id),{status:"done"});ladeOffers();}
</script>
</body>
</html>