<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Steal a Brainrot Trade üí∏</title>
<style>
  body {font-family:Arial;background:#1b1b2a;color:#f5f5f5;text-align:center;}
  input,button,textarea{padding:8px;margin:5px;border-radius:5px;border:none;}
  button{cursor:pointer;background:#4e5efc;color:white;}
  button:hover{background:#6f7bff;}
  .brainrot{background:#2c2c44;margin:10px auto;padding:10px;width:350px;border-radius:8px;text-align:left;}
  .outofstock{opacity:0.5;}
  img{border-radius:8px;}
  h1{margin-top:20px;}
</style>
</head>
<body>

<h1>üí∏ Steal a Brainrot - Trade Center üí∏</h1>

<div id="user-info"></div>

<div id="auth-box">
  <input type="email" id="email" placeholder="E-Mail">
  <input type="password" id="password" placeholder="Passwort">
  <button id="login-btn">Login</button>
  <button id="logout-btn" style="display:none;">Logout</button>
</div>

<h2>üß† Unsere Brainrots</h2>
<div id="brainrot-list">Lade Brainrots...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig={
  apiKey:"AIzaSyCSGYr4opBpK_G-U7Vs7o5boniVVojClaU",
  authDomain:"brainrottrade-bada5.firebaseapp.com",
  projectId:"brainrottrade-bada5",
  storageBucket:"brainrottrade-bada5.firebasestorage.app",
  messagingSenderId:"141473188329",
  appId:"1:141473188329:web:3548a50d851d8807bbe378",
  measurementId:"G-TJR1CS3SSP"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const auth=getAuth(app);

const brainrotList=document.getElementById("brainrot-list");
const emailInput=document.getElementById("email");
const passwordInput=document.getElementById("password");
const loginBtn=document.getElementById("login-btn");
const logoutBtn=document.getElementById("logout-btn");
const userInfo=document.getElementById("user-info");

loginBtn.addEventListener("click",async()=>{
  try{
    await signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value);
    alert("‚úÖ Login erfolgreich!");
  }catch(err){alert("‚ùå "+err.message);}
});
logoutBtn.addEventListener("click",async()=>{await signOut(auth);});

onAuthStateChanged(auth,(user)=>{
  if(user){
    userInfo.textContent=`üë§ Eingeloggt als: ${user.email}`;
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    emailInput.style.display="none";
    passwordInput.style.display="none";
  }else{
    userInfo.textContent="Nicht eingeloggt";
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    emailInput.style.display="inline-block";
    passwordInput.style.display="inline-block";
  }
  ladeBrainrots();
});

// Brainrots laden
async function ladeBrainrots(){
  brainrotList.innerHTML="Lade...";
  const snapshot=await getDocs(collection(db,"brainrots"));
  brainrotList.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data=docSnap.data();
    const div=document.createElement("div");
    div.className="brainrot"+(data.stock===0?" outofstock":"");
    div.innerHTML=`
      <strong>${data.name}</strong><br>
      <em>Rarity:</em> ${data.rarity||"Unbekannt"}<br>
      <em>Stock:</em> ${data.stock??0}<br>
      <img src="${data.imageUrl||'https://placehold.co/120x120'}" width="120"><br>
    `;

    if(data.stock>0){
      div.innerHTML+=`
        <input type="text" id="user-${docSnap.id}" placeholder="Roblox Username"><br>
        <textarea id="offer-${docSnap.id}" placeholder="Dein Angebot" rows="2" cols="30"></textarea><br>
        <button onclick="sendOffer('${docSnap.id}')">üì© Angebot senden</button>
      `;
    }else{
      div.innerHTML+=`<p>‚ùå Nicht verf√ºgbar</p>`;
    }
    brainrotList.appendChild(div);
  });
}

// Angebot senden
window.sendOffer = async function(id){
  const user=auth.currentUser;
  if(!user){alert("Bitte zuerst anmelden!");return;}
  const robloxUsername=document.getElementById(`user-${id}`).value.trim();
  const offerText=document.getElementById(`offer-${id}`).value.trim();
  if(!robloxUsername||!offerText){alert("Bitte alles ausf√ºllen!");return;}

  await addDoc(collection(db,"offers"),{
    brainrotId:id,
    robloxUsername,
    offerText,
    fromEmail:user.email,
    status:"pending",
    createdAt:serverTimestamp()
  });

  alert("‚úÖ Dein Angebot wurde gesendet!");
  document.getElementById(`user-${id}`).value="";
  document.getElementById(`offer-${id}`).value="";
};
</script>

</body>
</html>