<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Steal a Brainrot - User ğŸ’¸</title>
<style>
body { font-family: Arial; background:#1b1b2a; color:#f5f5f5; text-align:center; }
input, button, textarea { padding:8px; margin:5px; border-radius:5px; border:none; }
button { cursor:pointer; background:#4e5efc; color:white; }
button:hover { background:#6f7bff; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:15px; justify-items:center; padding:15px; max-width:900px; margin:auto; }
.brainrot { background:#2c2c44; padding:10px; border-radius:10px; width:90%; text-align:left; }
.outofstock { opacity:0.5; }
img { border-radius:8px; display:block; margin:0 auto; }
h1 { margin-top:20px; }
#popup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; }
#popup-content { background:#2c2c44; padding:20px; border-radius:10px; width:90%; max-width:400px; text-align:center; }
#offers { margin-top:30px; background:#2c2c44; padding:15px; border-radius:10px; max-width:600px; margin-inline:auto; }
</style>
</head>
<body>

<h1>ğŸ’¸ Steal a Brainrot - Trade Center ğŸ’¸</h1>

<div id="user-info"></div>

<div id="auth-box">
  <input type="email" id="email" placeholder="E-Mail">
  <input type="password" id="password" placeholder="Passwort">
  <button id="register-btn">Registrieren</button>
  <button id="login-btn">Login</button>
  <button id="logout-btn" style="display:none;">Logout</button>
</div>

<h2>ğŸ§  Unsere Brainrots</h2>
<div id="brainrot-list" class="grid">Lade Brainrots...</div>

<!-- Popup fÃ¼r Angebote -->
<div id="popup">
  <div id="popup-content">
    <h3 id="popup-name"></h3>
    <img id="popup-img" width="150">
    <p><em id="popup-rarity"></em></p>
    <p><strong>Stock:</strong> <span id="popup-stock"></span></p>
    <div id="offer-section">
      <input type="text" id="popup-username" placeholder="Roblox Username"><br>
      <textarea id="popup-offertext" placeholder="Dein Angebot" rows="2" cols="28"></textarea><br>
      <button id="popup-send">ğŸ“© Angebot senden</button>
    </div>
    <button onclick="closePopup()">âŒ SchlieÃŸen</button>
  </div>
</div>

<h2>ğŸ“œ Deine Angebote</h2>
<div id="offers">Bitte anmelden...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, query, where, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = { /* Dein Firebase Config hier */ };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const brainrotList=document.getElementById("brainrot-list");
const emailInput=document.getElementById("email");
const passwordInput=document.getElementById("password");
const registerBtn=document.getElementById("register-btn");
const loginBtn=document.getElementById("login-btn");
const logoutBtn=document.getElementById("logout-btn");
const userInfo=document.getElementById("user-info");
const offersDiv=document.getElementById("offers");
let brainrotCache={};

// Registrierung
registerBtn.addEventListener("click", async()=>{ 
  try{ await createUserWithEmailAndPassword(auth,emailInput.value,passwordInput.value); alert("âœ… Registrierung erfolgreich!"); }catch(err){ alert("âŒ "+err.message);} 
});
// Login
loginBtn.addEventListener("click", async()=>{ 
  try{ await signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value); alert("âœ… Login erfolgreich!"); }catch(err){ alert("âŒ "+err.message);} 
});
// Logout
logoutBtn.addEventListener("click", async()=>{ await signOut(auth); });

// Auth-Status
onAuthStateChanged(auth,(user)=>{
  if(user){ 
    userInfo.textContent=`ğŸ‘¤ Eingeloggt als: ${user.email}`;
    loginBtn.style.display="none"; registerBtn.style.display="none"; logoutBtn.style.display="inline-block";
    emailInput.style.display="none"; passwordInput.style.display="none";
    ladeBrainrots(); ladeEigeneAngebote();
  }else{
    userInfo.textContent="Nicht eingeloggt"; loginBtn.style.display="inline-block"; registerBtn.style.display="inline-block"; logoutBtn.style.display="none"; emailInput.style.display="inline-block"; passwordInput.style.display="inline-block";
    brainrotList.innerHTML=""; offersDiv.innerHTML="Bitte anmelden...";
  }
});

// Brainrots laden
async function ladeBrainrots(){
  brainrotList.innerHTML="Lade...";
  const snapshot=await getDocs(collection(db,"brainrots"));
  brainrotList.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data=docSnap.data();
    brainrotCache[docSnap.id]=data.name;
    const div=document.createElement("div");
    div.className="brainrot"+(data.stock===0?" outofstock":"");
    div.innerHTML=`<strong>${data.name}</strong><br><em>Rarity:</em> ${data.rarity||"Unbekannt"}<br><img src="${data.imageUrl||'https://placehold.co/120x120'}" width="120"><br><button onclick="openPopup('${docSnap.id}','${data.name}','${data.imageUrl}','${data.rarity}','${data.stock??0}')">â„¹ï¸ Details</button>`;
    brainrotList.appendChild(div);
  });
}

// Popup
window.openPopup=function(id,name,img,rarity,stock){
  document.getElementById("popup-name").textContent=name;
  document.getElementById("popup-img").src=img;
  document.getElementById("popup-rarity").textContent=rarity;
  document.getElementById("popup-stock").textContent=stock;
  document.getElementById("popup").style.display="flex";
  document.getElementById("popup-send").onclick=()=>sendOffer(id);
};
window.closePopup=function(){ document.getElementById("popup").style.display="none"; };

// Angebot senden
async function sendOffer(id){
  const user=auth.currentUser; if(!user){ alert("Bitte anmelden!"); return; }
  const username=document.getElementById("popup-username").value.trim();
  const text=document.getElementById("popup-offertext").value.trim();
  if(!username||!text){ alert("Alles ausfÃ¼llen!"); return; }
  const brainrotName=brainrotCache[id]||"Unbekannt";
  await addDoc(collection(db,"offers"),{ brainrotId:id, brainrotName, robloxUsername:username, offerText:text, fromEmail:user.email, status:"pending", createdAt:serverTimestamp() });
  alert(`âœ… Angebot fÃ¼r "${brainrotName}" gesendet!`);
  closePopup(); ladeEigeneAngebote();
}

// Eigene Angebote laden
async function ladeEigeneAngebote(){
  const user=auth.currentUser; if(!user) return;
  offersDiv.innerHTML="Lade...";
  const snapshot=await getDocs(collection(db,"offers"));
  if(snapshot.empty){ offersDiv.innerHTML="Keine Angebote."; return; }
  let html="";
  snapshot.forEach(docSnap=>{
    const o=docSnap.data();
    if(o.fromEmail===user.email){
      let icon="ğŸ•’"; if(o.status==="accepted") icon="âœ…"; else if(o.status==="rejected") icon="âŒ"; else if(o.status==="done") icon="ğŸ‰";
      html+=`<div style="border-bottom:1px solid #444; padding:5px;">${icon} <strong>${o.brainrotName}</strong><br><em>${o.offerText}</em><br>Roblox: ${o.robloxUsername}<br>Status: ${o.status||"pending"}${o.status==="done"?`<br><button onclick="deleteOffer('${docSnap.id}')">ğŸ—‘ï¸ LÃ¶schen</button>`:""}</div>`;
    }
  });
  offersDiv.innerHTML=html;
}

// LÃ¶schen
window.deleteOffer=async function(id){ if(confirm("Willst du lÃ¶schen?")){ await deleteDoc(doc(db,"offers",id)); ladeEigeneAngebote(); } }
</script>

</body>
</html>